<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

</body>

</html>
<script>
  // function foo() {
  //   console.log(this.a);
  // }
  // var obj1 = {
  //   a: 2,
  //   foo: foo
  // };
  // var obj2 = {
  //   a: 3,
  //   foo: foo
  // };
  // obj1.foo(); // 2
  // obj2.foo(); // 3
  // obj1.foo.call(obj2); // 3
  // obj2.foo.call(obj1); // 2
  /************************/
  // function foo(something) {
  //   this.a = something;
  //   console.log('this: ', this);
  // }
  // var obj1 = {
  //   foo: foo
  // };
  // var obj2 = {};
  // obj1.foo(2);
  // console.log(obj1.a); // 2
  // obj1.foo.call(obj2, 3);
  // console.log(obj2.a); // 3
  // var bar = new obj1.foo(4);
  // console.log(obj1.a); // 2 
  // console.log(bar.a); // 4
  /************************/

  // function foo(something) {
  //   this.a = something;
  //   console.log('this: ', this);
  // }
  // var obj1 = {};
  // var bar = foo.bind(obj1);
  // bar(2);
  // console.log(obj1.a); // 2
  // var baz = new bar(3);
  // console.log(obj1.a); // 2 
  // console.log(baz.a); // 3
  /************************/
  // function foo(p1, p2) {
  //   this.val = p1 + p2;
  // }
  // // 之所以使用 null 是因为在本例中我们并不关心硬绑定的 this 是什么 // 反正使用 new 时 this 会被修改
  // var bar = foo.bind(null, "p1");
  // var baz = new bar("p2");
  // baz.val; // p1p2

  /************************/
  // 例外this
  // function foo() {
  //   console.log(this.a);
  // }
  // var a = 2;
  // foo.call(null); // 2

  // function foo(a, b) {
  //   console.log("a:" + a + ", b:" + b);
  // }
  // // 把数组“展开”成参数
  // foo.apply(null, [2, 3]); // a:2, b:3
  // // 使用 bind(..) 进行柯里化
  // var bar = foo.bind(null, 2);
  // bar(5); // a:2, b:5
  /************************/
  // function foo() {
  //   console.log(this.a);
  // }
  // var a = 2;
  // var o = {
  //   a: 3,
  //   foo: foo
  // };
  // var p = {
  //   a: 4
  // };
  // o.foo(); // 3
  // (p.foo = o.foo)(); // 2
  /************************/

  if (!Function.prototype.softBind) {
    Function.prototype.softBind = function (obj) {
      var fn = this;
      // 捕获所有 curried 参数
      var curried = [].slice.call(arguments, 1);
      var bound = function () {
        return fn.apply(
          (!this || this === (window || global)) ?
          obj : this,
          curried.concat.apply(curried, arguments)
        );
      };
      bound.prototype = Object.create(fn.prototype);
      return bound;
    };
  }

  function foo() {
    console.log("name: " + this.name);
    console.log('this: ', this);
  }
  var obj = {
      name: "obj"
    },
    obj2 = {
      name: "obj2"
    },
    obj3 = {
      name: "obj3"
    };
  var fooOBJ = foo.softBind(obj);
  fooOBJ(); // name: obj
  obj2.foo = foo.softBind(obj);
  obj2.foo(); // name: obj2 <---- 看!!!
  fooOBJ.call(obj3); // name: obj3 <---- 看! 
  setTimeout(obj2.foo, 10);
  // name: obj <---- 应用了软绑定
</script>

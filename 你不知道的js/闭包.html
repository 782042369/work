<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>

</body>

</html>
<script>
  /************************/
  // function foo() {
  //   var a = 2;

  //   function bar() {
  //     console.log(a); // 2
  //   }
  //   bar();
  // }
  // foo();
  /************************/
  // function foo() {
  //   var a = 2;

  //   function bar() {
  //     console.log(a);
  //   }
  //   return bar;
  // }
  // var baz = foo();
  // baz(); // 2
  /************************/
  // function foo() {
  //   var a = 2;
  //   function baz() {
  //     console.log(a); // 2
  //   }
  //   bar(baz);
  // }
  // function bar(fn) {
  //   fn(); // 妈妈快看呀，这就是闭包!
  // }
  // foo();

  /************************/
  // var fn;
  // function foo() {
  //   var a = 2;
  //   function baz() {
  //     console.log(a);
  //   }
  //   fn = baz; // 将 baz 分配给全局变量 
  // }
  // function bar() {
  //   fn(); // 妈妈快看呀，这就是闭包!
  // }
  // foo();
  // bar(); // 2
  /************************/

  // function wait(message) {
  //   setTimeout(function timer() {
  //     console.log(message);
  //   }, 1000);
  // }
  // wait("Hello, closure!");
  /************************/

  // for (var i = 1; i <= 5; i++) {
  //   setTimeout(function timer() {
  //     console.log(i);
  //   }, i * 1000);
  // }
  // for (var i = 1; i <= 5; i++) {
  //   (function () {
  //     var j = i;
  //     setTimeout(function timer() {
  //       console.log(j);
  //     }, j * 1000);
  //   })();
  // }
  // for (var i = 1; i <= 5; i++) {
  //   (function (j) {
  //     setTimeout(function timer() {
  //       console.log(j);
  //     }, j * 1000);
  //   })(i);
  // }
  // for (var i = 1; i <= 5; i++) {
  //   let j = i; // 是的，闭包的块作用域! 
  //   setTimeout(function timer() {
  //     console.log(j);
  //   }, j * 1000);
  // }
  // for (let i = 1; i <= 5; i++) {
  //   setTimeout(function timer() {
  //     console.log(i);
  //   }, i * 1000);
  // }
  /************************/
  /************************/
  // function foo() {
  //   var something = "cool";
  //   var another = [1, 2, 3];

  //   function doSomething() {
  //     console.log(something);
  //   }

  //   function doAnother() {
  //     console.log(another.join(" ! "));
  //   }
  // }

  // function CoolModule() {
  //   var something = "cool";
  //   var another = [1, 2, 3];

  //   function doSomething() {
  //     console.log(something);
  //   }

  //   function doAnother() {
  //     console.log(another.join(" ! "));
  //   }
  //   return {
  //     doSomething: doSomething,
  //     doAnother: doAnother
  //   };
  // }
  // var foo = CoolModule();
  // foo.doSomething(); // cool
  // foo.doAnother(); // 1 ! 2 ! 3
  /************************/
  // var foo = (function CoolModule(id) {
  //   function change() {
  //     // 修改公共 API
  //     publicAPI.identify = identify2;
  //   }

  //   function identify1() {
  //     console.log(id);
  //   }

  //   function identify2() {
  //     console.log(id.toUpperCase());
  //   }
  //   var publicAPI = {
  //     change: change,
  //     identify: identify1
  //   };
  //   return publicAPI;
  // })("foo module");
  // foo.identify(); // foo module
  // foo.change();
  // foo.identify(); // FOO MODULE
  /************************/
  var MyModules = (function Manager() {
    var modules = {};

    function define(name, deps, impl) {
      for (var i = 0; i < deps.length; i++) {
        deps[i] = modules[deps[i]];
      }
      modules[name] = impl.apply(impl, deps);
    }

    function get(name) {
      return modules[name];
    }
    return {
      define: define,
      get: get
    };
  })();

  MyModules.define("bar", [], function () {
    function hello(who) {
      return "Let me introduce: " + who;
    }
    return {
      hello: hello
    };
  });
  MyModules.define("foo", ["bar"], function (bar) {
    var hungry = "hippo";

    function awesome() {
      console.log(bar.hello(hungry).toUpperCase());
    }
    return {
      awesome: awesome
    };
  });
  var bar = MyModules.get("bar");
  console.log('bar: ', bar);
  var foo = MyModules.get("foo");
  console.log('foo: ', foo);
  console.log(
    bar.hello("hippo")
  ); // Let me introduce: hippo foo.awesome(); // LET ME INTRODUCE: HIPPO
</script>
